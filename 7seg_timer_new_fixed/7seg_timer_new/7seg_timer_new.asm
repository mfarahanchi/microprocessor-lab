.include "m1280def.inc"

.org	0x0000
		RJMP BEGIN

.org	OC1Aaddr
		JMP	interrupt_OC1

.org	OC0Aaddr
		JMP	interrupt_OC0


BEGIN:

	LDI		R16,HIGH(RAMEND)
	OUT		SPH,R16
	LDI		R16,LOW(RAMEND)
	OUT		SPL,R16
	//changing sts to out : prevents timer1 loop

	LDI		R16,0xFF
	STS		DDRK,R16
	OUT		DDRF,R16

	; INITALIZE TIMER 0
	LDI R16, 0x02
	OUT TCCR0A, R16
	LDI R16, 0x05
	OUT TCCR0B, R16
	LDI R16, 0x22
	OUT OCR0A, R16
	LDI R16, 0x02
	STS TIMSK0, R16
	

	;INITIALIZE TIMER 1
	LDI		R16,0x00
	STS		TCCR1A,R16
	LDI		R16,0x0D
	STS 	TCCR1B,R16
	LDI		R16,0x2A
	STS		OCR1AH,R16
	LDI		R16,0x30
	STS		OCR1AL,R16
	LDI		R16,0x02
	STS		TIMSK1,R16
	SEI

INIT:
	LDI		R25,0x00
	LDI 	R26,0x00
	LDI 	R27,0x00
	LDI 	R28,0x00
	LDI		R29,0x01



	
HERE :			
RJMP HERE

interrupt_OC1:

	
FIRST:
		INC R25
		CPI R25, 10
		BREQ SECOND
		RETI

SECOND:	
		LDI R25, 0x00
		INC R26
		CPI R26, 6
		BREQ THIRD
		RETI

THIRD : 
		LDI R26, 0x00
		INC R27
		CPI R27, 10
		BREQ FOURTH
		RETI

FOURTH:
		LDI R27, 0x00
		INC R28
		CPI R28, 6
		BREQ Fif
		RETI
Fif:	LDI R28,0x00
		RETI
				


interrupt_OC0:

	FIRST_DIGIT:
		CPI R29, 1
		BRNE SECOND_DIGIT
		
		MOV R17, R25
		CALL CONVERT
		//LDI R21,0x88
		LDI R17,0b10000000
		OUT		PORTF,R17
		STS		PORTK,R21		

		LDI R29, 2
		RETI
	SECOND_DIGIT:
		CPI R29, 2
		BRNE THIRD_DIGIT

		MOV R17, R26
		CALL CONVERT
		LDI R17,0b01000000
		OUT		PORTF,R17
		STS		PORTK,R21

		LDI R29,3
		RETI
	THIRD_DIGIT:
		CPI R29, 3
		BRNE FOURTH_DIGIT

		MOV R17, R27
		CALL CONVERT
		LDI R17,0b00100000
		OUT		PORTF,R17
		STS		PORTK,R21

		LDI R29, 4
		RETI
	FOURTH_DIGIT:

		MOV R17, R28
		CALL CONVERT
		LDI R17,0b00010000
		OUT		PORTF,R17
		STS		PORTK,R21

		LDI R29, 1
		RETI

CONVERT:	
			CPI R17, 0
			BRNE	ONE
			LDI	R21,0xEB
			RET

ONE:		CPI R17, 1
			BRNE	TWO
			LDI	R21,0x88
			RET

TWO:		CPI R17, 2
			BRNE	THREE
			LDI	R21,0xB3
			RET

THREE:		CPI R17, 3
			BRNE	FOUR
			LDI	R21,0xBA
			RET

FOUR:		CPI R17, 4
			BRNE	FIVE
			LDI	R21,0xD8
			RET

FIVE:		CPI R17, 5
			BRNE	SIX
			LDI	R21,0x7A
			RET

SIX:		CPI R17, 6
			BRNE	SEVEN
			LDI	R21,0x7B
			RET

SEVEN:		CPI R17, 7
			BRNE	EIGHT
			LDI	R21,0xA8
			RET

EIGHT:		CPI R17, 8
			BRNE	NINE
			LDI	R21,0xFB
			RET

NINE:		CPI R17, 9
			LDI	R21,0xFA
RET
 	



	
